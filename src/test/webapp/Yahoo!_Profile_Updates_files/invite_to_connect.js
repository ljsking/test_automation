YAHOO.namespace("AddCxn");YAHOO.AddCxn=(function(){var C=YAHOO.lang,B=YAHOO.util.Dom,A=YAHOO.util.Event;return{dialog:null,conf:null,sender:null,States:{StateManager:{currState:null,node:null,init:function(D){this.node=document.getElementById(D)},setState:function(D){var E=this.currState;if(E!=D){if(E){E.cleanUp()}E=this.currState=D;if(!E){YAHOO.AddCxn.dialog.destroy();return }E.start(this.node)}}},State:{start:function(D){throw new Error("The start method of state must be overriden")},cleanUp:function(){}}},DialogStates:(function(){var D={singleHeader:"{0} als Verbindung einladen",multiHeader:"Andere Nutzer als Verbindung einladen",successHeader:"Invite To Connect",to:"<strong>An:</strong> (Mail-Adresse oder Namen eingeben)",inviteHeader:"<strong>Text der Einladung:</strong> (hier können Sie eine persönliche Nachricht ergänzen)",defaultInvite:"Ich möchte Dich zu Yahoo! einladen. Wir können dann Fotos, Bewertungen und Kontaktdaten austauschen. Siehe Dir mein Profil an!",sendInvite:"EINLADUNG SENDEN",cancel:"Abbrechen",sending:"Einladung wird gesendet",inviteSuccessHead:"Einladung wurde erfolgreich gesendet!",inviteMultiSuccessHead:"Einladungen wurden erfolgreich gesendet!",inviteSuccessBody:"Angenommene Einladungen werden als Verbindungen unter Yahoo! Kontakte hinzugefügt.",successSent:"{0} Einladungen wurden erfolgreich gesendet!",enterRecipient:"Geben Sie einen oder mehrere Empfänger im Feld „An“ ein und wiederholen Sie den Vorgang.",enterValidRecipient:"Einer oder mehrere Empfänger sind ungültig. Bitte korrigieren Sie die Adresse und wiederholen Sie den Vorgang.",reachedRecipientLimit:"Sie haben die maximale Anzahl von Empfängern pro Einladung erreicht.",alreadyIn:"{0} gehört bereits zu Ihren Verbindungen!",noInviteSent:"An {0} wurde keine Einladung gesendet.",viewGivenProfile:"Profil von {0} ansehen",invitesNotSentHeader:"Einladungen wurden nicht gesendet!",pendingInvitationHeader:"An {0} wurde <strong>keine</strong> Einladung gesendet.",pendingInvitation:"{0} hat bereits vor kurzem eine Einladung von Ihnen erhalten. Angenommene Einladungen werden als Verbindungen unter Yahoo! Kontakte hinzugefügt.",multiPendingInvitation:"Ihre Einladung wurde bereits an einen oder mehrere Empfänger gesendet.",multiAlreadyConnected:"Sie sind bereits mit einem oder mehreren Empfängern verbunden.",tooManyPendingInvitations:"Wir können Ihre Anforderung derzeit nicht verarbeiten. Sie haben im Moment zu viele offene Verbindungen.",tooManyRecipients:"Wir können Ihre Anforderung nicht verarbeiten. Sie haben die maximale Anzahl von Empfängern pro Einladung überschritten.",cantInviteSelf:"Sie können sich nicht selbst einladen.",afterAccept:"Angenommene Einladungen werden als Verbindungen unter Yahoo! Kontakte hinzugefügt.",invitesNotSent:"Einige der Nutzer, die Sie eingeladen haben, sind bereits als Verbindungen vorhanden. Diesen Nutzern wurde keine Einladung gesendet.",errorHeader:"Fehler",unknownError:"Bei der Verarbeitung Ihrer Anforderung ist leider ein Fehler aufgetreten. Bitte wiederholen Sie den Vorgang später.",emptyProfileUpdateError:"Wir können Ihr Profil derzeit nicht aktualisieren. Bitte wiederholen Sie den Vorgang später.",emptyProfileDataError:"Bitte geben Sie %s ein, bevor Sie fortfahren.",emptyProfileAllDataError:"Bitte geben Sie die angeforderten Daten ein, bevor Sie fortfahren.",emptyProfileHeader:"<strong>Informationen erforderlich</strong>",emptyProfileSubHeader:"Geben Sie bitte, bevor Sie fortfahren, Ihren Namen ein, damit andere Nutzer wissen, wer Sie sind.",emptyProfileFieldHeader:"Ihr Name ist nicht öffentlich einsehbar.",aboutToInviteName:"Sie laden {0} als Verbindung ein. {0} muss Ihre Einladung annehmen, um als Verbindung übernommen zu werden.",aboutToInviteXPeople:"Sie laden {0} Nutzer als Verbindungen ein. Diese Nutzer müssen Ihre Einladung annehmen, um als Verbindung übernommen zu werden.",aboutToInvitePeople:"Die oben aufgeführten Nutzer erhalten eine Einladung, auf Yahoo! eine Verbindung mit Ihnen herzustellen. Angenommene Einladungen werden als Verbindungen unter Yahoo! Kontakte hinzugefügt.",yourName:"Ihr Name",firstName:"Vorname",lastName:"Nachname",nickName:"Kurzname",done:"Fertig",OK:"&nbsp; OK &nbsp;",continueStr:"Weiter",imAllowedDomains:"yahoo.com,rocketmail.com,ymail.com,yahoo.com.ar,y7mail.com,yahoo.com.au,yahoo.bg,yahoo.com.br,yahoo.ca,yahoo.cl,yahoo.com.cn,yahoo.cn,yahoo.com.co,yahoo.cz,yahoo.de,yahoo.dk,yahoo.com.ec,yahoo.ee,yahoo.es,yahoo.fr,yahoo.gr,yahoo.com.hk,yahoo.hu,yahoo.co.id,yahoo.ie,yahoo.co.in,yahoo.it,yahoo.co.kr,yahoo.lt,yahoo.lv,yahoo.com.mx,yahoo.com.my,yahoo.com.ng,yahoo.no,yahoo.co.nz,yahoo.com.pe,yahoo.com.ph,yahoo.com.pk,yahoo.pl,yahoo.ro,yahoo.se,yahoo.com.sg,yahoo.co.th,yahoo.tr,kimo.com,yahoo.com.tw,yahoo.ua,yahoo.co.uk,yahoo.com.ve,yahoo.com.vn,yahoo.co.za,bellsouth.net,ameritech.net,att.net,attworld.com,flash.net,nvbell.net,pacbell.net,prodigy.net,sbcglobal.net,snet.net,wans.net,btinternet.com,btopenworld.com,talk21.com,rogers.com,nl.rogers.com,demobroadband.com,xtra.co.nz,verizon.net",substitute:function(F){var E=arguments.length;for(var G=1;G<E;++G){F=F.replace(new RegExp("\\{"+(G-1)+"\\}","g"),arguments[G])}return F}};return{stateMgr:null,startBaseState:null,singleStartState:null,multiStartState:null,successState:null,conflictState:null,unknownErrorState:null,emptyProfileState:null,emptyProfileUpdateErrorState:null,policy:null,init:function(){var K=YAHOO.AddCxn.clone;var J=this.policy;var G=YAHOO.AddCxn.States.State;var E=function(L){YAHOO.AddCxn.dialog.setHeader(L)};var I=function(L){YAHOO.AddCxn.dialog.setBody(L)};var F=function(){YAHOO.util.Event.addListener.apply(YAHOO.util.Event,arguments)};var H=function(){YAHOO.util.Event.removeListener.apply(YAHOO.util.Event,arguments)};this.stateMgr=K(YAHOO.AddCxn.States.StateManager);this.startBaseState=K(G);this.startBaseState.start=function(L){};this.startBaseState.startHeader=function(){};this.startBaseState.addButtons=function(){var L=new YAHOO.widget.Button({id:"sendBtn",type:"button",label:D.sendInvite,container:"buttonHolder"});var M=new YAHOO.widget.Button({id:"cancelBtn",type:"button",label:D.cancel,container:"buttonHolder"});L.addListener("click",this.onsend);M.addListener("click",this.oncancel)};this.startBaseState.setupEnterHandler=function(){var M=this;var L=new YAHOO.util.KeyListener(document,{keys:13},{fn:M.onsend,scope:M,correctScope:true});YAHOO.AddCxn.dialog.cfg.queueProperty("keylisteners",L)};this.startBaseState.cleanUp=function(){H("sendBtn","click");H("cancelBtn","click")};this.startBaseState.onsend=function(){};this.startBaseState.sendInviteRequest=function(M){var P=['{"invite":{"target":[',M,"],",'"senderGivenName":"',YAHOO.AddCxn.sender.givenName,'",','"senderFamilyName":"',YAHOO.AddCxn.sender.familyName,'",','"msg" : ""',"}}"].join("");var L=YAHOO.lang.JSON.parse("["+M+"]");var R={cache:[L],timeout:YAHOO.AddCxn.conf.timeout,success:function(S){YAHOO.AddCxn.DialogStates.successState.recipients=L;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.successState)},failure:function(S){switch(S.status){case 409:YAHOO.AddCxn.DialogStates.conflictState.errorObject=S;YAHOO.AddCxn.DialogStates.conflictState.recipients=L;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.conflictState);break;case 1223:YAHOO.AddCxn.DialogStates.successState.recipients=L;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.successState);break;default:YAHOO.AddCxn.DialogStates.unknownErrorState.errorObject=S;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.unknownErrorState)}}};YAHOO.util.Connect.initHeader("Accept","application/json");YAHOO.util.Connect.initHeader("Content-Type","application/json");var Q=YAHOO.AddCxn.conf.urlExtras?("&"+YAHOO.AddCxn.conf.urlExtras):"";var O=YAHOO.AddCxn.conf.proxy+"/v1/user/"+YAHOO.AddCxn.sender.guid+"/sent_invites&wssid="+YAHOO.AddCxn.conf.wssid+Q;var N=YAHOO.util.Connect.asyncRequest("POST",O,R,P);YAHOO.AddCxn.DialogStates.startBaseState.showSending()};this.startBaseState.showSending=function(){if(B.get("addCxnDialog_send_mask")){B.setStyle("buttonHolder","display","none");B.setStyle("addCxnDialog_send_mask","display","block");B.get("sendStatus").innerHTML="<img src='http://l.yimg.com/a/i/us/pim/dclient/h/img/md5/c8ad9845c9414424cb5854238af212b0_1.gif' alt=''/> "+D.sending}};this.startBaseState.getInviteMessage=function(){return""};this.startBaseState.getSpaceIdBeacon=function(M){var N=151700002;var O=YAHOO.AddCxn.conf.src;var L={prf:{kiosk:151700005,compose:151700009,confirm:151700010},ab:{kiosk:151700006,compose:151700011,confirm:151700012},cg:{kiosk:151700007,compose:151700015,confirm:151700016},ym:{kiosk:151700008,compose:151700013,confirm:151700014}};if(L[O]&&L[O][M]){N=L[O][M]}N+=parseInt(YAHOO.AddCxn.conf.spaceid_offset,10);return["<image id='_beacon' src='http://geo.yahoo.com/serv?s=",N,"&t=",Math.random(),"' width=1 height=1>"].join("")};this.startBaseState.getJsonForRecipient=function(M,O,P,N,L){P=P||"-1";N=N||"";L=L||"";return['{"type":"',M,'","value":"',O,'",','"targetGivenName":"',N,'","targetFamilyName":"',L,'",','"targetContactid":',P,"}"].join("")};this.startBaseState.oncancel=function(){YAHOO.AddCxn.Events.InviteCancelEvent.fire();YAHOO.AddCxn.DialogStates.stateMgr.setState(null)};this.singleStartState=K(this.startBaseState);this.singleStartState.start=function(){this.startHeader();I(["<div class='light_mask' id='addCxnDialog_send_mask'></div>","<p>",D.substitute(D.aboutToInviteName,J.recipient.displayName),"</p>",this.getInviteMessage(),"<div id='sendStatus'></div>","<div id='buttonHolder'>",YAHOO.AddCxn.DialogStates.startBaseState.getSpaceIdBeacon("compose"),"</div>"].join(""));this.addButtons();this.setupEnterHandler()};this.singleStartState.startHeader=function(){E("<h1>"+D.substitute(D.singleHeader,J.recipient.displayName)+"</h1>")};this.singleStartState.onsend=function(){var L=YAHOO.AddCxn.DialogStates.startBaseState.getJsonForRecipient("GUID",J.recipient.guid,null,J.recipient.displayName);YAHOO.AddCxn.DialogStates.startBaseState.sendInviteRequest(L)};this.multiStartState=K(this.startBaseState);this.multiStartState.start=function(){this.startHeader();I(["<div class='light_mask' id='addCxnDialog_send_mask'></div>",this.getToHTML(),this.getInviteNotice(),"<div id='sendStatus'></div>","<div id='buttonHolder'>",YAHOO.AddCxn.DialogStates.startBaseState.getSpaceIdBeacon("compose"),"</div>"].join(""));this.addButtons();this.setupEnterHandler();this.attachListeners()};this.multiStartState.startHeader=function(){var L=YAHOO.AddCxn.DialogStates.policy.recipients;var M;if(L&&L.length==1){M=D.substitute(D.singleHeader,L[0].displayName)}else{M=D.multiHeader}E("<h1>"+M+"</h1>")};this.multiStartState.getInviteNotice=function(){var L=YAHOO.AddCxn.DialogStates.policy.recipients;if(L&&(L.length==1)){return""}if(YAHOO.AddCxn.DialogStates.policy.nonEditable){return"<div><p>"+D.substitute(D.aboutToInviteXPeople,YAHOO.AddCxn.DialogStates.policy.recipients.length)+"</p></div>"}return"<div><p>"+D.aboutToInvitePeople+"</p></div>"};this.multiStartState.getToHTML=function(){var P;var N=YAHOO.AddCxn.DialogStates.policy.recipients;if(YAHOO.AddCxn.DialogStates.policy.nonEditable){P="<textarea id='addcxn_ac_input' style='display:none;'>{0}</textarea><div id='recipient_error' class='addcxn_rcpt_error' style='display: none;'></div>";if(N&&(N.length==1)){P+="<p>"+D.substitute(D.aboutToInviteName,N[0].displayName)+"</p>"}}else{P=["<label for='addcxn_input'>",D.to,"</label>","<div id='addcxn_ac_container'>","<textarea id='addcxn_ac_input'>{0}</textarea>","<div id='addcxn_ac_options'></div>","<div id='recipient_error' class='addcxn_rcpt_error' style='display: none;'></div>","</div>"].join("")}var M="";var N=YAHOO.AddCxn.DialogStates.policy.recipients;var O="";var L=null;for(i=0;i<N.length;i++){L=(YAHOO.AddCxn.DialogStates.policy.nonEditable&&N[i].yid)?N[i].yid:N[i].displayName;O=N[i].handle||"";if(L){if(L.match(/@|,|;/g)){L='"'+L+'"'}if(O){O=" <"+O+">"}}M+=[i!==0?", ":"",L||"",O].join("")}return D.substitute(P,M)};this.multiStartState.attachListeners=function(){F("addcxn_ac_input","keydown",this.onkeydown);YAHOO.util.Event.onAvailable("addcxn_ac_input",YAHOO.AddCxn.DialogStates.multiStartState.focusAndAdjustFieldHeight);YAHOO.LoadAddCxn.getInstance().ACLoadSuccessEvent.subscribe(function(L){if(!YAHOO.AddCxn.DialogStates.policy.noAutoComplete){if(YAHOO.AddCxn.ContactsCache.acData){YAHOO.AddCxn.DialogStates.multiStartState.initAutocomplete()}else{YAHOO.AddCxn.DialogStates.multiStartState.getContacts()}}})};this.multiStartState.onsend=function(){var L=YAHOO.AddCxn.DialogStates.multiStartState.parseRecipientField();if(!L){YAHOO.AddCxn.DialogStates.multiStartState.showRecipientError(D.enterRecipient);return }else{if(L.length>=YAHOO.AddCxn.conf.maxRec){var N={responseText:'{"error":{"detail":"10004=Too many targets in one request"}}'};YAHOO.AddCxn.DialogStates.unknownErrorState.errorObject=N;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.unknownErrorState);return }}var M=YAHOO.AddCxn.DialogStates.multiStartState.getJsonForRecipients(L);if(!M){YAHOO.AddCxn.DialogStates.multiStartState.showRecipientError(D.enterValidRecipient);return }YAHOO.AddCxn.DialogStates.multiStartState.sendInviteRequest(M)};this.multiStartState.onkeydown=function(){setTimeout(YAHOO.AddCxn.DialogStates.multiStartState.adjustFieldHeight,0);var L=this.value.match(/,|;/g);if(L&&L.length>=YAHOO.AddCxn.conf.maxRec){var M=YAHOO.util.Event.getEvent();switch(M.keyCode){case 8:case 9:case 46:case 37:case 39:case 35:case 36:YAHOO.AddCxn.DialogStates.multiStartState.clearRecipientError();break;default:YAHOO.AddCxn.DialogStates.multiStartState.showRecipientError(D.reachedRecipientLimit);YAHOO.util.Event.stopEvent(M)}}else{YAHOO.AddCxn.DialogStates.multiStartState.clearRecipientError()}};this.multiStartState.focusAndAdjustFieldHeight=function(){var L=YAHOO.util.Dom.get("addcxn_ac_input");if(L&&YAHOO.util.Dom.getStyle(L,"display")!=="none"){L.focus();YAHOO.AddCxn.DialogStates.multiStartState.adjustFieldHeight(L)}};this.multiStartState.adjustFieldHeight=function(M){M=YAHOO.lang.isString(M)?YAHOO.util.Dom.get(M):null;if(!M){M=YAHOO.util.Dom.get("addcxn_ac_input")}var O=62;var L=parseInt(M.clientHeight,10);var N=parseInt(M.scrollHeight,10);if(Math.abs(L-N)>4){N+=4;if((O!==null)&&(N>O)){N=O}if(N&&N!=M.offsetHeight){YAHOO.util.Dom.setStyle(M,"height",N+"px")}}};this.multiStartState.showRecipientError=function(N){var M,L=YAHOO.util.Dom.get("addcxn_ac_input");L.focus();YAHOO.util.Dom.addClass(L,"rcpt_error");M=YAHOO.util.Dom.get("recipient_error");YAHOO.util.Dom.setStyle(M,"display","");M.innerHTML="<div class='errorIcon'></div>"+N};this.multiStartState.clearRecipientError=function(){var L=document.getElementById("addcxn_ac_input");YAHOO.util.Dom.removeClass(L,"rcpt_error");YAHOO.util.Dom.setStyle("recipient_error","display","none")};this.multiStartState.getGuidForRecipient=function(N){var L=YAHOO.AddCxn.DialogStates.policy.recipients;for(var M=0;M<L.length;M++){if((YAHOO.lang.trim(L[M].displayName)==N)&&(!L[M].processed)){L[M].processed=true;return L[M].guid||false}}return false};this.multiStartState.getCidForRecipient=function(O){O=O.toLowerCase();var P=-1;var M="";var L=YAHOO.AddCxn.DialogStates.policy.recipients;for(var N=0;N<L.length;N++){M=L[N].handle?L[N].handle.toLowerCase():"";if(M&&M==O){P=L[N].cid;break}}if(!P||P==-1){P=YAHOO.AddCxn.ContactsCache.cidHash[O]}return P||-1};this.multiStartState.getCidAndNameForYid=function(P){P=P.toLowerCase();var S=-1;var R="";var N=null;var O=false;var L=YAHOO.AddCxn.DialogStates.policy.recipients;for(var M=0;M<L.length;M++){R=L[M].yid?L[M].yid.toLowerCase():"";if(R&&R==P){S=L[M].cid;N=L[M].displayName;O=true;break}}if(!O){return null}var Q={displayName:N,cid:S};return Q};this.multiStartState.parseRecipientField=function(){var L=document.getElementById("addcxn_ac_input").value;if(!L||L.match(/^\s+$/)){return null}var M=new window.AddressParser();return M.parseRecipientField(L)};this.multiStartState.getJsonForRecipients=function(L){var P,Q,N,M,R=null;var O="";for(i=0;i<L.length;i++){R=null;if(typeof L[i].emailAddress!="undefined"){P="EMAIL";Q=L[i].emailAddress;if(!YAHOO.AddCxn.DialogStates.multiStartState.validateEmail(Q)){return null}N=L[i].displayName||"";R=YAHOO.AddCxn.DialogStates.multiStartState.getCidForRecipient(L[i].emailAddress)}else{if(YAHOO.AddCxn.DialogStates.policy.nonEditable&&(Q=YAHOO.AddCxn.DialogStates.multiStartState.getCidAndNameForYid(L[i].displayName))){if(!YAHOO.AddCxn.DialogStates.multiStartState.validateYid(L[i].displayName)){return null}P="YID";N=Q.displayName||"";R=Q.cid;Q=L[i].displayName}else{Q=YAHOO.AddCxn.DialogStates.multiStartState.getGuidForRecipient(L[i].displayName);if(!Q){return null}P="GUID";N=L[i].displayName||""}}if(i!==0){O+=","}O+=YAHOO.AddCxn.DialogStates.startBaseState.getJsonForRecipient(P,Q,R,N,M)}return O};this.multiStartState.validateEmail=function(L){if(L&&L.match(/^[\w%+-]+(\.{1}[\w%+-]+)*@([A-Z0-9-]+\.)+[A-Z0-9-]{2,6}$/i)&&(L.length>=6)){return true}return false};this.multiStartState.validateYid=function(M){if(!M){return false}var L=M.match(/^[A-Z][\w\.%+-]{3,63}(?:@([A-Z0-9-\.]{4,63}))?$/i);if(!L){return false}if(L[1]&&(D.imAllowedDomains.indexOf(L[1].toLowerCase())==-1)){return false}return true};this.multiStartState.getContacts=function(){var O={cache:[],timeout:YAHOO.AddCxn.conf.timeout,success:function(R){try{var P=YAHOO.lang.JSON.parse(R.responseText);YAHOO.AddCxn.DialogStates.multiStartState.convertContactsJson(P.contacts.contact)}catch(Q){}},failure:function(P){}};YAHOO.util.Connect.initHeader("Accept","application/json");var N=YAHOO.AddCxn.conf.urlExtras?("&"+YAHOO.AddCxn.conf.urlExtras):"";var M=YAHOO.AddCxn.conf.proxy+"/v1/user/"+YAHOO.AddCxn.sender.guid+"/contacts;out=name,nickname,email;count=5000&wssid="+YAHOO.AddCxn.conf.wssid+N;var L=YAHOO.util.Connect.asyncRequest("GET",M,O)};this.multiStartState.convertContactsJson=function(M){var T=[];var R=null;var P=[];var S=[];var L=[];var Q=null;for(var O=0;O<M.length;O++){Q=M[O].id;P=[];S=[];L=[];for(var N=0;N<M[O].fields.length;N++){if(M[O].fields[N].type=="name"){S.push(M[O].fields[N].value)}else{if(M[O].fields[N].type=="email"){R=M[O].fields[N].value;P.push(R);YAHOO.AddCxn.ContactsCache.cidHash[R.toLowerCase()]=Q}else{if(M[O].fields[N].type=="nickname"){L.push(M[O].fields[N].value.replace(/&quot;/g,'"').replace(/&#39;/g,"'"))}else{}}}}T=T.concat(YAHOO.AddCxn.DialogStates.multiStartState.createAllPermutations(P,S,L))}YAHOO.AddCxn.ContactsCache.acData=T.sort();YAHOO.AddCxn.DialogStates.multiStartState.initAutocomplete()};this.multiStartState.createAllPermutations=function(R,Q,N){var P=[],L=null,M;var O=R.length;while(O--){L=null;if(Q.length>0){for(M=0;M<Q.length;M++){L=[Q[M].givenName,Q[M].givenName?" ":"",Q[M].middleName,Q[M].middleName?" ":"",Q[M].familyName," <",R[O],">"].join("").replace(/&quot;/g,'"').replace(/&#39;/g,"'");P.push(L)}}else{if(N.length){for(M=0;M<N.length;M++){P.push(N[M]+" <"+R[O]+">")}}else{P.push(R[O])}}}return P};this.multiStartState.initAutocomplete=function(){var N="addcxn_ac_input";var L="addcxn_ac_options";var M=new YAHOO.widget.DS_JSArray(YAHOO.AddCxn.ContactsCache.acData);M.queryMatchContains=true;var O=new YAHOO.widget.AutoComplete(N,L,M);O.delimChar=[",",";"];O.maxResultsDisplayed=100;O.animVert=false;O.formatResult=function(S,W){var Q=S[0];if(Q.length>60){var P=new RegExp("(.*)(<)(.*>)","gi");var V=P.exec(Q);if(V){var U=V[1];var T=V[3];if(U.length>40){U=U.substr(0,40)+"..."}if(T.length>20){T=T.substr(0,20)+"..."}Q=U+"<"+T+">"}}var R=W+"(?!([a-z0-9]*;))";return Q.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(new RegExp(R,"gi"),"<b>$&</b>")}};this.multiStartState.cleanUp=function(){H("sendBtn","click",this.onsend);H("cancelBtn","click",this.oncancel);H("addcxn_ac_input","keydown");YAHOO.LoadAddCxn.getInstance().ACLoadSuccessEvent.unsubscribe()};this.successState=K(G);this.successState.start=function(L){this.startHeader();var M=[D.inviteMultiSuccessHead,D.inviteSuccessBody];if(this.recipients.length==1){M[0]=D.inviteSuccessHead}I(["<div class='checkIcon'></div><h1>",M[0],"</h1><p>",M[1],"</p><div id='buttonHolder'>",this.getSpaceIdBeacon(),"</div>"].join(""));this.addButtons()};this.successState.startHeader=function(L){E("<h1>"+D.successHeader+"</h1>")};this.successState.addButtons=function(){var L=new YAHOO.widget.Button({id:"doneBtn",type:"button",label:D.OK,container:"buttonHolder"});L.addListener("click",this.onclick,this)};this.successState.onclick=function(){YAHOO.AddCxn.Events.InviteSuccessEvent.fire();YAHOO.AddCxn.DialogStates.stateMgr.setState(null)};this.successState.getSpaceIdBeacon=function(){return YAHOO.AddCxn.DialogStates.startBaseState.getSpaceIdBeacon("confirm")};this.successState.cleanUp=function(){H("doneBtn","click")};this.conflictState=K(this.successState);this.conflictState.start=function(M){var P,L;this.startHeader();var N=this.errorObject.responseText;if(!N){YAHOO.AddCxn.DialogStates.unknownErrorState.errorObject=YAHOO.AddCxn.DialogStates.conflictState.errorObject;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.unknownErrorState);return }var O=N.match(/\d{5}/);O=O?O[0]:null;switch(O){case 10001:P=[D.invitesNotSentHeader,D.multiPendingInvitation];if(this.recipients.length==1){L=this.recipients[0].targetGivenName?this.recipients[0].targetGivenName:this.recipients[0].value;P=[D.substitute(D.pendingInvitationHeader,L),D.substitute(D.pendingInvitation,L)];this.insertProfileLink(N)}I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"<span id='addcxnProfileLink'></span></p>","<div id='buttonHolder'></div>"].join(""));break;case 10002:P=[D.invitesNotSentHeader,D.multiAlreadyConnected];if(this.recipients.length==1){L=this.recipients[0].targetGivenName?this.recipients[0].targetGivenName:this.recipients[0].value;P=[D.substitute(D.alreadyIn,L),D.substitute(D.noInviteSent,L)];this.insertProfileLink(N)}I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"<span id='addcxnProfileLink'></span></p>","<div id='buttonHolder'></div>"].join(""));break;case 10003:P=[D.invitesNotSentHeader,D.tooManyPendingInvitations];I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"</p>","<div id='buttonHolder'></div>"].join(""));break;default:if(N.search(/Pending invite already exist/)!=-1){P=[D.invitesNotSentHeader,D.multiPendingInvitation];if(this.recipients.length==1){L=this.recipients[0].targetGivenName?this.recipients[0].targetGivenName:this.recipients[0].value;P=[D.substitute(D.pendingInvitationHeader,L),D.substitute(D.pendingInvitation,L)];this.insertProfileLink(N)}I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"<span id='addcxnProfileLink'></span></p>","<div id='buttonHolder'></div>"].join(""))}else{if(N.search(/Connection already exists/)!=-1){P=[D.invitesNotSentHeader,D.multiAlreadyConnected];if(this.recipients.length==1){L=this.recipients[0].targetGivenName?this.recipients[0].targetGivenName:this.recipients[0].value;P=[D.substitute(D.alreadyIn,L),D.substitute(D.noInviteSent,L)];this.insertProfileLink(N)}I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"<span id='addcxnProfileLink'></span></p>","<div id='buttonHolder'></div>"].join(""))}else{if(N.search(/count exceeds allowed threshold/)!=-1){P=[D.invitesNotSentHeader,D.tooManyPendingInvitations];I(["<div class='infoIcon'></div><h1>",P[0],"</h1>","<p>",P[1],"</p>","<div id='buttonHolder'></div>"].join(""))}else{YAHOO.AddCxn.DialogStates.unknownErrorState.errorObject=YAHOO.AddCxn.DialogStates.conflictState.errorObject;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.unknownErrorState);return }}}}this.addButtons()};this.conflictState.onclick=function(M,L){if((L.recipients.length==1)&&(!YAHOO.AddCxn.DialogStates.policy.treatAlreadyConnectedAsFailure)){YAHOO.AddCxn.Events.InviteSuccessEvent.fire()}else{YAHOO.AddCxn.Events.InviteFailureEvent.fire()}YAHOO.AddCxn.DialogStates.stateMgr.setState(null)};this.conflictState.insertProfileLink=function(P){var O=P.match(/(target=)(\w{26})/);var L=O?O[2]:null;if(!L){return }var R={cache:[],timeout:YAHOO.AddCxn.conf.timeout,success:function(V){var T=document.getElementById("addcxnProfileLink");if(!T){return }var S=YAHOO.lang.JSON.parse(V.responseText);var U=S?S.profile.profileUrl:null;if(U){T.innerHTML=[" <a href='",U,"' target='_blank'>",D.substitute(D.viewGivenProfile,S.profile.nickname),"</a>"].join("")}},failure:function(S){}};YAHOO.util.Connect.initHeader("Accept","application/json");YAHOO.util.Connect.initHeader("Content-Type","application/json");var Q=YAHOO.AddCxn.conf.urlExtras?("&"+YAHOO.AddCxn.conf.urlExtras):"";var N=YAHOO.AddCxn.conf.proxy+"/v1/user/"+L+"/profile/tinyusercard&wssid="+YAHOO.AddCxn.conf.wssid+Q;var M=YAHOO.util.Connect.asyncRequest("GET",N,R)};this.unknownErrorState=K(this.successState);this.unknownErrorState.start=function(L){var N;this.startHeader();if(!this.errorObject.responseText){this.errorObject.responseText=""}var M=this.errorObject.responseText.match(/\d{5}/);M=M?parseInt(M[0]):null;switch(M){case 10004:N=[D.invitesNotSentHeader,D.tooManyRecipients];I(["<div class='infoIcon'></div><h1>",N[0],"</h1>","<p>",N[1],"</p>","<div id='buttonHolder'></div>"].join(""));break;case 10005:N=[D.invitesNotSentHeader,D.cantInviteSelf];I(["<div class='infoIcon'></div><h1>",N[0],"</h1>","<p>",N[1],"</p>","<div id='buttonHolder'></div>"].join(""));break;default:if(this.errorObject.responseText.search(/Cannot send invitation to source/)!=-1){N=[D.invitesNotSentHeader,D.cantInviteSelf];I(["<div class='infoIcon'></div><h1>",N[0],"</h1>","<p>",N[1],"</p>","<div id='buttonHolder'></div>"].join(""))}else{I(["<div class='infoIcon'></div><h1>",D.unknownError,"</h1><p style='font-size:small'>","Error: ",this.errorObject.status," ","<br />",YAHOO.AddCxn.conf.debug?this.errorObject.responseText.replace(/,/g,", "):"","</p>","<div id='buttonHolder'></div>"].join(""))}break}this.addButtons();this.setBgColor()};this.unknownErrorState.startHeader=function(){E("<h1>"+D.errorHeader+"</h1>")};this.unknownErrorState.onclick=function(M,L){YAHOO.AddCxn.Events.InviteFailureEvent.fire(L.errorObject);YAHOO.AddCxn.DialogStates.stateMgr.setState(null)};this.unknownErrorState.setBgColor=function(L){var M=YAHOO.util.Dom.getElementsByClassName("bd","div",document.getElementById("addCxnDialog"))[0];if(M){L=L||"#ffeaea";M.style.backgroundColor=L}};this.unknownErrorState.errorObject=null;this.emptyProfileUpdateErrorState=K(this.unknownErrorState);this.emptyProfileUpdateErrorState.start=function(L){I(["<div class='infoIcon'></div><h1>",D.emptyProfileUpdateError,"</h1>","<div id='buttonHolder'></div>"].join(""));this.addButtons();this.setBgColor()};this.emptyProfileUpdateErrorState.onclick=function(){YAHOO.AddCxn.Events.InviteFailureEvent.fire();YAHOO.AddCxn.DialogStates.stateMgr.setState(null)};this.emptyProfileState=K(G);this.emptyProfileState.start=function(L){this.startHeader();I(this.getHTML());this.addButtons()};this.emptyProfileState.getHTML=function(){return["<div class='light_mask' id='addCxnDialog_send_mask'></div><div id='emptyProfile'>","<div class='infoIcon'></div><h1>",D.emptyProfileSubHeader,"</h1>","<div id='name_error' class='error'></div>","<table><tbody><tr><th>","<label for='givenName'>",D.yourName,"</label>","</th><td>","<input id='givenName' class='userfield' type='text' maxlength='40' size='15'value='",YAHOO.AddCxn.sender.givenName,"'></input>","&nbsp;<input id='familyName' class='userfield' type='text' maxlength='40' size='24' value='",YAHOO.AddCxn.sender.familyName,"'></input>","</td><tr><th>&nbsp;</th><td><div class='info'>",D.emptyProfileFieldHeader,"</div></td><tr><th>","<label for='nickName'>",D.nickName,"</label>","</th><td>","<input id='nickName' class='userfield' type='text' maxlength='40' size='47' value='",YAHOO.AddCxn.sender.nickName,"'></input>","</td></tr></tbody></table>","<div id='sendStatus'></div><div id='buttonHolder'>","</div></div>"].join("")};this.emptyProfileState.startHeader=function(){E("<h1>"+D.emptyProfileHeader+"</h1>")};this.emptyProfileState.addButtons=function(){var L=new YAHOO.widget.Button({id:"sendBtn",type:"button",label:D.continueStr,container:"buttonHolder"});L.addListener("click",this.onsend);var M=new YAHOO.widget.Button({id:"cancelBtn",type:"button",label:D.cancel,container:"buttonHolder"});M.addListener("click",this.oncancel)};this.emptyProfileState.cleanUp=function(){H("sendBtn","click");H("cancelBtn","click")};this.emptyProfileState.onsend=function(){var M=document.getElementById("givenName")?document.getElementById("givenName").value:"";var O=document.getElementById("familyName")?document.getElementById("familyName").value:"";var Q=document.getElementById("nickName")?document.getElementById("nickName").value:"";YAHOO.util.Dom.getElementsByClassName("userfield","input","addCxnDialog",function(V){V.style.backgroundColor="#FFFFFF"});var P=[];if(M===""){P.push(D.firstName);document.getElementById("givenName").style.backgroundColor="#ffe5e5"}if(O===""){P.push(D.lastName);document.getElementById("familyName").style.backgroundColor="#ffe5e5"}if(Q===""){P.push(D.nickName);document.getElementById("nickName").style.backgroundColor="#ffe5e5"}if(P.length>0){var S=document.getElementById("name_error");if(S){S.innerHTML="<div class='errorIcon'></div>"+((P.length==3)?D.emptyProfileAllDataError:D.emptyProfileDataError.replace("%s",P.join(", ")));S.style.display="block";return }}var T=['{ "updateprofile":{','"nickname":"',Q,'","givenName":"',M,'","familyName":"',O,'","nux":"2"',"}}"].join("");var U={cache:[],timeout:YAHOO.AddCxn.conf.timeout,success:function(V){YAHOO.AddCxn.sender.nux="2";if(J.emptyProfileOnly===true){YAHOO.AddCxn.Events.InviteSuccessEvent.fire();YAHOO.AddCxn.DialogStates.stateMgr.setState(null)}else{if(typeof J.recipient!="undefined"){YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.singleStartState)}else{YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.multiStartState);YAHOO.LoadAddCxn.getInstance().load_autocomplete()}}},failure:function(V){switch(V.status){case 500:YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.emptyProfileUpdateErrorState);break;default:YAHOO.AddCxn.DialogStates.unknownErrorState.errorObject=V;YAHOO.AddCxn.DialogStates.stateMgr.setState(YAHOO.AddCxn.DialogStates.unknownErrorState);break}}};YAHOO.util.Connect.initHeader("Accept","application/json");YAHOO.util.Connect.initHeader("Content-Type","application/json");var N=YAHOO.AddCxn.conf.urlExtras?("&"+YAHOO.AddCxn.conf.urlExtras):"";var L=YAHOO.AddCxn.conf.proxy+"/v1/user/"+YAHOO.AddCxn.sender.guid+"/profile&wssid="+YAHOO.AddCxn.conf.wssid+N;var R=YAHOO.util.Connect.asyncRequest("POST",L,U,T)};this.emptyProfileState.oncancel=function(){YAHOO.AddCxn.Events.InviteCancelEvent.fire();YAHOO.AddCxn.DialogStates.stateMgr.setState(null)}}}})(),Events:{InviteSuccessEvent:null,InviteFailureEvent:null,InviteCancelEvent:null,init:function(){this.InviteSuccessEvent=new YAHOO.util.CustomEvent("InviteSuccess");this.InviteFailureEvent=new YAHOO.util.CustomEvent("InviteFailure");this.InviteCancelEvent=new YAHOO.util.CustomEvent("InviteCancel")}},ContactsCache:{acData:null,cidHash:[],flush:function(){YAHOO.AddCxn.ContactsCache.acData=null;YAHOO.AddCxn.ContactsCache.cidHash=[]}},clone:function(E){function D(){}D.prototype=E;return new D()},open:function(E){if(this.DialogStates.stateMgr&&this.DialogStates.stateMgr.currState){return }this.dialog=new YAHOO.widget.SimpleDialog("addCxnDialog",{width:"457px",fixedcenter:true,modal:true,visible:false,draggable:false,close:false});this.DialogStates.policy=E;this.DialogStates.init();var D=this.DialogStates.stateMgr;D.init("addCxnDialog");if(E.emptyProfileOnly===true){D.setState(this.DialogStates.emptyProfileState)}else{if(this.sender.nux=="0"){D.setState(this.DialogStates.emptyProfileState)}else{if(typeof E.recipient!="undefined"){D.setState(this.DialogStates.singleStartState)}else{D.setState(this.DialogStates.multiStartState);YAHOO.LoadAddCxn.getInstance().load_autocomplete()}}}this.Events.init();this.dialog.render(document.body);this.dialog.show()}}})();(function(){YAHOO.LoadAddCxn=function(){};var B=YAHOO.lang,C=YAHOO.LoadAddCxn;var A=null;C.getInstance=function(){if(!B.isObject(A)){A=new C()}return A};C.prototype={LoadSuccessEvent:new YAHOO.util.CustomEvent("LoadSuccess",this),LoadFailureEvent:new YAHOO.util.CustomEvent("LoadFailure",this),ACLoadSuccessEvent:new YAHOO.util.CustomEvent("ACLoadSuccess",this),ACLoadFailureEvent:new YAHOO.util.CustomEvent("ACLoadFailure",this),setConfig:function(D){if(!D){D={}}if(!D.path){throw new Exception("Path must be specifed!")}this.path=D.path;this.devmode=D.devmode?true:false},load:function(){var D=["event","connection","dom","container","button","element","json"];this.loadCustom(D)},loadCustom:function(G){var D,F,E;if(!G){this.load()}G.push("addcxn_css");E=this;F={require:G,loadOptional:false,onSuccess:function(H){E.LoadSuccessEvent.fire(H)},onFailure:function(J,I){E.LoadFailureEvent.fire(J,I);var H="LOAD FAILED: "+J;if(I){H+=", "+YAHOO.lang.dump(I)}YAHOO.log(H)}};D=new YAHOO.util.YUILoader(F);D.addModule({name:"addcxn_css",type:"css",fullpath:this.path+"invite_to_connect.css"});D.insert()},load_autocomplete:function(){var E,G,D,F;G=["autocomplete"];if(this.devmode){G.push("addressparser")}E=this;F={require:G,loadOptional:false,onSuccess:function(H){E.ACLoadSuccessEvent.fire(H)},onFailure:function(J,I){E.ACLoadFailureEvent.fire(J,I);var H="LOAD FAILED: "+J;if(I){H+=", "+YAHOO.lang.dump(I)}YAHOO.log(H)}};D=new YAHOO.util.YUILoader(F);if(this.devmode){D.addModule({name:"addressparser",type:"js",requires:[],fullpath:this.path+"AddressParser.js"})}D.insert()}}})();(function(){ParsedAddressNode=function(){};ParsedAddressNode.prototype={setDisplayName:function(A){this.displayName=A.replace(/"/g,"")},getDisplayName:function(){return this.displayName},setEmailAddress:function(B){var A=B.match(/^[<(]+(.*)[)>]+$/);if(!A){this.emailAddress=B}else{this.emailAddress=A[1]}},getEmailAddress:function(){return this.emailAddress}};AddressPart=function(B,A){this.type=B;this.string=A}})();function AddressParser(){if(!(this instanceof AddressParser)){return new AddressParser()}var D={WHITE_SPACE:0,SEPARATOR:1,EMAIL_ADDRESS:2,EMAIL_ADDRESS_INSIDE:3,DOUBLE_QUOTED_DISPLAY_NAME:4,DISPLAY_NAME:5,INVALID:6};var A={WHITE_SPACE:/^(\s+)/,SEPARATOR:/^([;,]+)/,EMAIL_ADDRESS:/^([^@ ;,<>]+@[^@ ;,<>]+\.[^@ ;,<>]+)/,EMAIL_ADDRESS_INSIDE:/^(\<\s*[^@ ;,<>"]+@[^@ ;,<>'"]+\.[^@ ;,<>'"]+\s*\>)/,DOUBLE_QUOTED_DISPLAY_NAME:/^("[^"]*")/,DISPLAY_NAME:/^\s*([^;,<>]*[^;, <>])/,INVALID:/^\s*([^;,]+)/};var C,B,E=this;C={messageNode:null,getAddressParts:function(Q){var N=[],R="#%#%#",I="\x11\x12\x14",K,L,J,H,M="",F="",G=0;var O=new RegExp(R,"g"),P=new RegExp(I,"g");Q=Q.replace(/\s+([^@ ;,<>'"][^@ ;,<>]*@[^@ ;,<>]+\.[^@ ;,<>]*[^@ ;,<>'"])/gi," <$1>");Q=Q.replace(/([;,]\s*)\"/g,"$1"+R).replace(/\"(\s*[;,<])/g,R+"$1").replace(/^\s*\"/,R).replace(/\"\s*$/,R);Q=Q.replace(/\"/g,I);Q=Q.replace(O,'"');while(Q.length){for(K in A){L=A[K];J=Q.match(L);if(!J){continue}if(D[K]==2){M=J[1];F=M.charAt(0);if((F=='"'||F=="'")&&(M.charAt(M.length-1)==F)){continue}}N[G++]=new AddressPart(D[K],J[1].replace(P,'"'));Q=Q.substr(J.index+J[0].length);break}}return N},getParsedAddressNodes:function(N){var K,H,F,I,L=0,G=0,O=[],J="",M;K=C.getAddressParts(N);while(F=K[L++]){J=F.string;I=J.match(/^([^"]*["][^"]*)$/);if(I){F.type=4}switch(F.type){case 0:continue;case 1:if(H){O[G++]=H;H=null}break;case 2:case 3:if(!H){H=new ParsedAddressNode(null,J)}H.setEmailAddress(J);O[G++]=H;H=null;break;case 4:case 5:if(H){M=H.getRawDisplayName()+J;H=new ParsedAddressNode(null,M);H.setDisplayName(M,false)}else{H=new ParsedAddressNode();H.setDisplayName(J,true)}break;case 6:M="";if(H){M=H.getDisplayName()+" "}H=new ParsedAddressNode();H.setDisplayName(M+J,false);O[G++]=H;H=null;break}}if(H){O[G++]=H}return O}};B={beginParse:function(F){C.messageNode=F;E.knownContactsUsed=[];E.unknownContactsToAdd=[]},parseRecipientField:function(S,L,O,N){if(arguments.length==3){N=true}var F,P,G,I,J=false;var H,R,M=0,Q=0,V=0,W=0,T=true,K=false;F=C.getParsedAddressNodes(S);V=E.unknownContactsToAdd.length;W=E.knownContactsUsed.length;while(P=F[Q++]){G=P.getEmailAddress();I=P.getDisplayName();K=false;if(G){if(T){E.unknownContactsToAdd[V++]=P}else{E.knownContactsUsed[W++]=P}K=true}else{try{J=B.isStringNicknameOrList(I)}catch(U){J=false}}if(!K&&O){M=(!P.isDisplayNameValid())?-1:0;O[P.getRawDisplayName()]=M}}return F},isStringNicknameOrList:function(L){var H,I,G="",F=0,J=0;try{H=AC_nickTokens}catch(K){return false}try{I=AC_Rot13(L)}catch(K){return false}if(H){while(G=H[F++]){if(G&&G[0]==I){return true}}}try{J=AC_allCanons.length}catch(K){J=0}for(F=0;F<J;F+=2){if(!AC_allCanons[F+1]&&AC_allCanons[F]==I){return true}}return false}};this.PARSE_TYPES=D;this.PARSE_EXPRESSIONS=A;this.knownContactsUsed=[];this.unknownContactsToAdd=[];this.beginParse=B.beginParse;this.parseRecipientField=B.parseRecipientField;this.isOKToAddContact=B.okToAddContact;this.isStringNicknameOrList=B.isStringNicknameOrList;this.constructor=function(){return E}};